module "sql" {
  source = "github.com/cloud-era/terraform-azure-component-sql?ref=init"

  eonId                         = var.eonId
  location                      = var.location
  vnetName                      = module.subnets.vnet_name
  vnetResourceGroupName         = module.subnets.system_rg_name
  pepSubnet                     = module.subnets.subnets_info["private"].subnet_name
  pepSubnetId                   = module.subnets.subnets_info["private"].subnet_id
  resourceGroupName             = module.landing_zone.mod_out_app_resource_group_names
  keyvaultName                  = module.akv.keyvault_name
  serverBaseName                = "${var.location}-${var.env_name}-${var.lz_name}"
  serverName                    = "${var.serverBaseName}-sqlserver"
  lzSPNName                     = var.lzSPNName
  lzSPNObjectId                 = var.lzSPNObjectId
  lzSPNClientId                 = var.lzSPNClientId
  aadadminUserName              = var.aadadminUserName
  aadadminObjectId              = var.aadadminObjectId
  sqlDatabases                  = var.sqlDatabases
  deployDatabaseInExistingServer = var.deployDatabaseInExistingServer
  sqlDatabaseActionGroup        = var.sqlDatabaseActionGroup
  sqlDatabaseMetricAlerts       = var.sqlDatabaseMetricAlerts
  sqlFailoverGroup              = var.sqlFailoverGroup
  logAnalyticsWorkspace        = var.logAnalyticsWorkspace
  diagnostics                   = var.diagnostics
  connectionPolicy              = var.connectionPolicy
  enableAdOnlyAuth              = var.enableAdOnlyAuth
  failoverRole                  = var.failoverRole
  primaryResourceGroupName      = var.primaryResourceGroupName
  primaryServerName             = var.primaryServerName
  primaryKeyvaultName           = var.primaryKeyvaultName
  primarySqlServerTdeKey        = var.primarySqlServerTdeKey
  secondaryResourceGroupName    = var.secondaryResourceGroupName
  secondaryServerName           = var.secondaryServerName
  enableDiagnostics             = var.enableDiagnostics
  triggerDBFurnishings          = var.triggerDBFurnishings
  secondaryDatabaseIdsForDiagnostics = var.secondaryDatabaseIdsForDiagnostics
}
